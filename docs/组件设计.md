# ChatGPT式对话应用组件设计

## 组件层次结构

```
App
├── Header
│   ├── Logo
│   ├── ThemeToggle
│   └── UserSettings
├── ChatInterface
│   ├── ConversationList
│   │   └── ConversationItem
│   ├── ChatWindow
│   │   ├── MessageList
│   │   │   └── MessageItem
│   │   └── InputArea
│   └── ContextMenu
└── SettingsPanel
    ├── APISettings
    ├── AppearanceSettings
    └── ExportSettings
```

## 核心组件详细设计

### ChatInterface 组件

**职责**：
- 聊天界面的主容器
- 管理会话列表和当前聊天窗口
- 处理聊天相关的逻辑

**状态**：
- 当前选中的会话ID
- 消息加载状态

**属性**：
- 无外部传入属性

**方法**：
- `handleNewConversation()` - 创建新会话
- `handleSelectConversation(id)` - 选择会话
- `handleDeleteConversation(id)` - 删除会话

### MessageList 组件

**职责**：
- 展示当前会话的消息列表
- 处理消息的加载和渲染
- 支持消息的右键菜单功能

**状态**：
- 消息数组
- 加载状态
- 右键菜单位置和状态

**属性**：
- `conversationId` - 当前会话ID

**方法**：
- `handleScroll()` - 处理滚动加载更多消息
- `handleContextMenu(event, messageId)` - 处理右键菜单
- `copyMessage(messageId)` - 复制消息内容
- `saveToClipboard(messageId)` - 保存到应用剪贴板

### InputArea 组件

**职责**：
- 用户输入区域
- 发送消息给AI
- 显示输入状态和提示

**状态**：
- 输入文本
- 发送状态（空闲/发送中）

**属性**：
- `conversationId` - 当前会话ID
- `onSendMessage` - 发送消息回调

**方法**：
- `handleInputChange(event)` - 处理输入变化
- `handleSubmit()` - 提交消息
- `handleKeyDown(event)` - 处理键盘事件（如Enter发送）

### SettingsPanel 组件

**职责**：
- 提供应用设置界面
- 管理API设置、外观设置等
- 提供导出功能的配置

**状态**：
- 设置选项卡状态
- 各项设置值

**属性**：
- `isOpen` - 面板是否打开
- `onClose` - 关闭回调

**方法**：
- `saveAPISettings(settings)` - 保存API设置
- `saveAppearanceSettings(settings)` - 保存外观设置
- `testAPIConnection()` - 测试API连接

### ContextMenu 组件

**职责**：
- 提供消息的右键菜单功能
- 支持复制、粘贴、导出等操作

**状态**：
- 菜单位置
- 菜单项状态

**属性**：
- `position` - 菜单位置坐标
- `messageId` - 当前操作的消息ID
- `onAction` - 菜单操作回调

**方法**：
- `handleCopy()` - 处理复制操作
- `handleSaveToClipboard()` - 保存到剪贴板
- `handleExport(format)` - 导出指定格式

## 组件交互流程

### 发送消息流程

1. 用户在InputArea输入文本并提交
2. InputArea调用`onSendMessage`回调
3. ChatInterface处理消息发送
4. 更新MessageList显示新消息
5. 等待AI响应
6. 收到响应后更新MessageList

### 导出内容流程

1. 用户右键点击消息
2. MessageList显示ContextMenu
3. 用户选择导出选项
4. ContextMenu调用对应导出函数
5. 根据选择的格式生成文件并下载

### API设置流程

1. 用户点击设置按钮
2. SettingsPanel打开
3. 用户在APISettings中填写API信息
4. 点击保存，调用`saveAPISettings`
5. 数据保存到localStorage
6. 应用即时更新使用新的API设置
