# 引用到新对话功能实施方案

## 1. 功能概述

"引用到新对话"功能允许用户将AI回复的内容作为引用创建新的对话。用户可以在引用基础上添加额外的提示词，系统将创建新对话并以引用内容+用户提示词作为首条消息发送给AI。

## 2. 用户界面流程

1. 用户点击AI消息下的"引用到新对话"按钮
2. 系统弹出对话框，显示要引用的内容
3. 用户在输入框中添加额外的提示词
4. 用户点击"发送"按钮
5. 系统创建新对话，发送组合消息，并跳转到新对话页面
6. AI响应该消息

## 3. 技术实现步骤

### 3.1 新增组件

1. **NewConversationDialog组件**
   - 创建一个新的对话框组件，参考现有ConfirmDialog样式
   - 包含引用内容展示区、用户输入框、取消和发送按钮
   - 样式与应用其他对话框保持一致

2. **扩展MessageActions组件**
   - 在现有按钮组中添加"引用到新对话"按钮
   - 添加处理函数和相应的状态

### 3.2 后端逻辑

1. **新对话创建**
   - 利用`useConversations`钩子的`createNewConversation`方法创建新对话
   - 构造初始消息（引用内容+用户提示词）
   - 使用`useChat`钩子的`sendMessage`方法发送消息

2. **导航逻辑**
   - 在创建对话并发送初始消息后，自动跳转到新对话

3. **消息格式化**
   - 创建适当的格式，区分引用内容和用户提示词

## 4. 具体实现文件

1. 新建文件：
   - `src/components/Dialog/NewConversationDialog.tsx`（新对话框组件）

2. 修改文件：
   - `src/components/Export/MessageActions.tsx`（添加新按钮和处理逻辑）
   - `src/components/Chat/ChatInterface.tsx`（处理新对话创建和跳转）

## 5. 执行步骤

1. 创建NewConversationDialog组件
2. 更新MessageActions组件，添加新按钮
3. 实现对话创建和消息发送逻辑
4. 测试功能：点击按钮→填写提示词→发送→检查新对话创建和AI响应

## 6. 注意事项

- 保持与现有UI风格的一致性
- 确保消息格式清晰，用户能区分引用内容和自己的提示词
- 实现良好的错误处理，例如空提示词检查和创建对话失败处理
- 考虑添加成功/失败提示
